{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\henriquet\\\\Desktop\\\\projetos\\\\SIM_WEB\\\\src\\\\pages\\\\Contas\\\\index.js\";\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Shimmer from 'react-shimmer-effect';\nimport { toast } from 'react-toastify';\nimport { confirmAlert } from 'react-confirm-alert';\nimport 'react-confirm-alert/src/react-confirm-alert.css';\nimport { EmptyContainer, TableWrapper } from './styles';\nimport { useModal } from '../../hook/useModal';\nimport Icon from '../../components/Icons';\nimport Select from '../../components/Select';\nimport LoadLine from '../../components/LoadLine';\nimport Container from '../../components/Container';\nimport ButtonAdd from '../../components/ButtonAdd';\nimport ConfirmAlert from '../../components/ConfirmAlert';\nimport InvoiceFormModal from './components/InvoiceFormModal';\nimport TableDropDownCustom from '../../components/TableDropDownCustom';\nimport api from '../../services/api';\nimport { changeDateAction } from '../../store/modules/consumo/invoice/actions';\nimport { formatPrice } from '../../util/format';\nconst clocksConfigs = [{\n  name: 'Gás',\n  value: 'GAS'\n}, {\n  name: 'Energia',\n  value: 'ELECTRICITY'\n}, {\n  name: 'Água',\n  value: 'WATER'\n}];\nexport default function Contas() {\n  const dispatch = useDispatch();\n  const [loading, setLoading] = useState(false);\n  const [clockListId, setClockListId] = useState([]);\n  const [invoices, setInvoices] = useState([]);\n  const [clockId, setClockId] = useState();\n  const [payload, setPayload] = useState({});\n  const clockIdRef = useRef();\n  const {\n    RenderModal: InvoiceModalWrapper,\n    ...invoiceHook\n  } = useModal();\n  const invoice = useSelector(state => state.invoice);\n  const hotelID = useSelector(state => state.user.profile.activeHotel);\n  const clockConfig = clocksConfigs.find(a => a.value === invoice.consumption[0]);\n\n  function getActiveHotelFromLocalStorage() {\n    const data = JSON.parse(localStorage.getItem('persist:sim'));\n    const user = data.user ? JSON.parse(data.user) : {};\n    const activeHotel = user.profile ? user.profile.activeHotel : 0;\n    return Number(activeHotel);\n  }\n\n  const loadClockID = useCallback(async () => {\n    try {\n      const response = await api.get(`/clocks`, {\n        params: {\n          hotel_id: getActiveHotelFromLocalStorage(),\n          clock_type: invoice.consumption[0]\n        }\n      });\n      setClockListId(response.data);\n    } catch (error) {\n      toast.error('Não foi possível carregar relógios.');\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [invoice, getActiveHotelFromLocalStorage()]);\n  useEffect(() => {\n    document.title = 'SIM - Consumo | Contas';\n    loadClockID();\n  }, [loadClockID]);\n  const loadInvoices = useCallback(async () => {\n    try {\n      setLoading(true);\n      if (invoice.date === null) return; // if (!clockId) return;\n\n      const setYear = invoice.date.getFullYear();\n      const response = await api.get(`/invoices`, {\n        params: {\n          hotel_id: hotelID,\n          clock_id: clockId,\n          year: setYear\n        }\n      });\n      setInvoices(response.data);\n    } catch (error) {// toast.error('Não foi possível carregar contas.');\n    }\n\n    setLoading(false);\n  }, [clockId, invoice.date, hotelID]);\n  useEffect(() => {\n    loadInvoices();\n  }, [loadInvoices]);\n  useEffect(() => {\n    dispatch(changeDateAction(new Date()));\n  }, []); // eslint-disable-line\n\n  const handleOpenModal = async (modalFn, item) => {\n    setPayload(item);\n    modalFn();\n  };\n\n  async function handleInvoiceDelete(id) {\n    async function deleteInvoice() {\n      try {\n        await api.delete(`/invoices/${id}`);\n        toast.success('Leitura de consumo excluída com sucesso.');\n        loadInvoices();\n      } catch (error) {\n        toast.error('Não foi possível remover conta selecionada.');\n      }\n    }\n\n    confirmAlert({\n      customUI: ({\n        onClose\n      } // eslint-disable-line\n      ) => React.createElement(ConfirmAlert, {\n        callback: deleteInvoice,\n        onClose: onClose,\n        icon: React.createElement(Icon, {\n          name: \"iconTrash\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        }),\n        title: \"Deletar leitura de consumo\",\n        message: React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }, \"Tem certeza que deseja deletar leitura de consumo?\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      })\n    });\n  }\n\n  function handleClockOnChange() {\n    var _clockIdRef$current$s;\n\n    setClockId((_clockIdRef$current$s = clockIdRef.current.selectedOptions[0]) === null || _clockIdRef$current$s === void 0 ? void 0 : _clockIdRef$current$s.id);\n  }\n\n  useEffect(() => {\n    handleClockOnChange();\n  }, [clockListId]);\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    id: \"modal-root\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }), React.createElement(InvoiceModalWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, React.createElement(InvoiceFormModal, {\n    handleClose: invoiceHook.hide,\n    item: payload,\n    loadInvoices: loadInvoices,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  })), React.createElement(Container, {\n    className: \"content full\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: `title title--dropdown dd-${invoice.consumption}`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"dd-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, \"Consumo de \", React.createElement(\"strong\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }, clockConfig && clockConfig.name), React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, invoice.date && invoice.date.getFullYear())), React.createElement(\"div\", {\n    className: \"dd-select\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, React.createElement(Icon, {\n    name: \"iconClockSmall\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }), React.createElement(Select, {\n    name: \"clockid\",\n    onChange: () => {\n      handleClockOnChange();\n    },\n    options: clockListId,\n    defaultOption: clockListId[0],\n    ref: clockIdRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }))), !clockListId.length ? React.createElement(EmptyContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"inner\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, React.createElement(Icon, {\n    name: \"iconClockBig\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, \"Nenhum rel\\xF3gio foi selecionado.\"))) : React.createElement(TableWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, React.createElement(\"table\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, React.createElement(\"thead\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205\n    },\n    __self: this\n  }, React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, \"M\\xEAs\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, \"Consumo\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, \"Valor (R$)\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, \"Anexo\"), React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, \"\\xA0\"))), React.createElement(\"tbody\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  }, loading ? React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    width: \"15%\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, React.createElement(Shimmer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, React.createElement(LoadLine, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }))), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }, React.createElement(Shimmer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, React.createElement(LoadLine, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223\n    },\n    __self: this\n  }))), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226\n    },\n    __self: this\n  }, React.createElement(Shimmer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  }, React.createElement(LoadLine, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228\n    },\n    __self: this\n  }))), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }, React.createElement(Shimmer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, React.createElement(LoadLine, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  }))), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }, React.createElement(Shimmer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }, React.createElement(LoadLine, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  })))) : invoices.map(item => React.createElement(\"tr\", {\n    key: item.id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245\n    },\n    __self: this\n  }, item.month_name), !item.read ? React.createElement(\"td\", {\n    colSpan: \"4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }, React.createElement(ButtonAdd, {\n    onClick: () => handleOpenModal(invoiceHook.show, item),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248\n    },\n    __self: this\n  }, React.createElement(Icon, {\n    name: \"iconPlus\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253\n    },\n    __self: this\n  }), \"Adicionar\")) : React.createElement(React.Fragment, null, React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259\n    },\n    __self: this\n  }, formatPrice(item.read).replace('R$', ''), item.unit_of_measurement.toLowerCase()), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263\n    },\n    __self: this\n  }, item.value_formatted), React.createElement(\"td\", {\n    className: \"attachment\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264\n    },\n    __self: this\n  }, React.createElement(\"a\", {\n    href: item.attachment,\n    className: \"attach\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265\n    },\n    __self: this\n  }, item.attachment.split('/').pop())), React.createElement(\"td\", {\n    width: \"75\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274\n    },\n    __self: this\n  }, React.createElement(TableDropDownCustom, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    onClick: () => {\n      handleInvoiceDelete(item.id);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276\n    },\n    __self: this\n  }, \"Excluir\")))))))))));\n}","map":{"version":3,"sources":["C:/Users/henriquet/Desktop/projetos/SIM_WEB/src/pages/Contas/index.js"],"names":["React","useState","useEffect","useCallback","useRef","useSelector","useDispatch","Shimmer","toast","confirmAlert","EmptyContainer","TableWrapper","useModal","Icon","Select","LoadLine","Container","ButtonAdd","ConfirmAlert","InvoiceFormModal","TableDropDownCustom","api","changeDateAction","formatPrice","clocksConfigs","name","value","Contas","dispatch","loading","setLoading","clockListId","setClockListId","invoices","setInvoices","clockId","setClockId","payload","setPayload","clockIdRef","RenderModal","InvoiceModalWrapper","invoiceHook","invoice","state","hotelID","user","profile","activeHotel","clockConfig","find","a","consumption","getActiveHotelFromLocalStorage","data","JSON","parse","localStorage","getItem","Number","loadClockID","response","get","params","hotel_id","clock_type","error","document","title","loadInvoices","date","setYear","getFullYear","clock_id","year","Date","handleOpenModal","modalFn","item","handleInvoiceDelete","id","deleteInvoice","delete","success","customUI","onClose","handleClockOnChange","current","selectedOptions","hide","length","map","month_name","read","show","replace","unit_of_measurement","toLowerCase","value_formatted","attachment","split","pop"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,WAArC,EAAkDC,MAAlD,QAAgE,OAAhE;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AAEA,OAAOC,OAAP,MAAoB,sBAApB;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,SAASC,YAAT,QAA6B,qBAA7B;AACA,OAAO,iDAAP;AAEA,SAASC,cAAT,EAAyBC,YAAzB,QAA6C,UAA7C;AAEA,SAASC,QAAT,QAAyB,qBAAzB;AAEA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,OAAOC,QAAP,MAAqB,2BAArB;AACA,OAAOC,SAAP,MAAsB,4BAAtB;AACA,OAAOC,SAAP,MAAsB,4BAAtB;AACA,OAAOC,YAAP,MAAyB,+BAAzB;AACA,OAAOC,gBAAP,MAA6B,+BAA7B;AACA,OAAOC,mBAAP,MAAgC,sCAAhC;AAEA,OAAOC,GAAP,MAAgB,oBAAhB;AAEA,SAASC,gBAAT,QAAiC,6CAAjC;AACA,SAASC,WAAT,QAA4B,mBAA5B;AAEA,MAAMC,aAAa,GAAG,CACpB;AACEC,EAAAA,IAAI,EAAE,KADR;AAEEC,EAAAA,KAAK,EAAE;AAFT,CADoB,EAKpB;AACED,EAAAA,IAAI,EAAE,SADR;AAEEC,EAAAA,KAAK,EAAE;AAFT,CALoB,EASpB;AACED,EAAAA,IAAI,EAAE,MADR;AAEEC,EAAAA,KAAK,EAAE;AAFT,CAToB,CAAtB;AAeA,eAAe,SAASC,MAAT,GAAkB;AAC/B,QAAMC,QAAQ,GAAGtB,WAAW,EAA5B;AACA,QAAM,CAACuB,OAAD,EAAUC,UAAV,IAAwB7B,QAAQ,CAAC,KAAD,CAAtC;AACA,QAAM,CAAC8B,WAAD,EAAcC,cAAd,IAAgC/B,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAACgC,QAAD,EAAWC,WAAX,IAA0BjC,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACkC,OAAD,EAAUC,UAAV,IAAwBnC,QAAQ,EAAtC;AACA,QAAM,CAACoC,OAAD,EAAUC,UAAV,IAAwBrC,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAMsC,UAAU,GAAGnC,MAAM,EAAzB;AACA,QAAM;AAAEoC,IAAAA,WAAW,EAAEC,mBAAf;AAAoC,OAAGC;AAAvC,MAAuD9B,QAAQ,EAArE;AAEA,QAAM+B,OAAO,GAAGtC,WAAW,CAACuC,KAAK,IAAIA,KAAK,CAACD,OAAhB,CAA3B;AACA,QAAME,OAAO,GAAGxC,WAAW,CAACuC,KAAK,IAAIA,KAAK,CAACE,IAAN,CAAWC,OAAX,CAAmBC,WAA7B,CAA3B;AAEA,QAAMC,WAAW,GAAGzB,aAAa,CAAC0B,IAAd,CAClBC,CAAC,IAAIA,CAAC,CAACzB,KAAF,KAAYiB,OAAO,CAACS,WAAR,CAAoB,CAApB,CADC,CAApB;;AAIA,WAASC,8BAAT,GAA0C;AACxC,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAAb;AACA,UAAMZ,IAAI,GAAGQ,IAAI,CAACR,IAAL,GAAYS,IAAI,CAACC,KAAL,CAAWF,IAAI,CAACR,IAAhB,CAAZ,GAAoC,EAAjD;AACA,UAAME,WAAW,GAAGF,IAAI,CAACC,OAAL,GAAeD,IAAI,CAACC,OAAL,CAAaC,WAA5B,GAA0C,CAA9D;AAEA,WAAOW,MAAM,CAACX,WAAD,CAAb;AACD;;AAED,QAAMY,WAAW,GAAGzD,WAAW,CAAC,YAAY;AAC1C,QAAI;AACF,YAAM0D,QAAQ,GAAG,MAAMxC,GAAG,CAACyC,GAAJ,CAAS,SAAT,EAAmB;AACxCC,QAAAA,MAAM,EAAE;AACNC,UAAAA,QAAQ,EAAEX,8BAA8B,EADlC;AAENY,UAAAA,UAAU,EAAEtB,OAAO,CAACS,WAAR,CAAoB,CAApB;AAFN;AADgC,OAAnB,CAAvB;AAOApB,MAAAA,cAAc,CAAC6B,QAAQ,CAACP,IAAV,CAAd;AACD,KATD,CASE,OAAOY,KAAP,EAAc;AACd1D,MAAAA,KAAK,CAAC0D,KAAN,CAAY,qCAAZ;AACD,KAZyC,CAa1C;;AACD,GAd8B,EAc5B,CAACvB,OAAD,EAAUU,8BAA8B,EAAxC,CAd4B,CAA/B;AAgBAnD,EAAAA,SAAS,CAAC,MAAM;AACdiE,IAAAA,QAAQ,CAACC,KAAT,GAAiB,wBAAjB;AAEAR,IAAAA,WAAW;AACZ,GAJQ,EAIN,CAACA,WAAD,CAJM,CAAT;AAMA,QAAMS,YAAY,GAAGlE,WAAW,CAAC,YAAY;AAC3C,QAAI;AACF2B,MAAAA,UAAU,CAAC,IAAD,CAAV;AAEA,UAAIa,OAAO,CAAC2B,IAAR,KAAiB,IAArB,EAA2B,OAHzB,CAKF;;AAEA,YAAMC,OAAO,GAAG5B,OAAO,CAAC2B,IAAR,CAAaE,WAAb,EAAhB;AAEA,YAAMX,QAAQ,GAAG,MAAMxC,GAAG,CAACyC,GAAJ,CAAS,WAAT,EAAqB;AAC1CC,QAAAA,MAAM,EAAE;AACNC,UAAAA,QAAQ,EAAEnB,OADJ;AAEN4B,UAAAA,QAAQ,EAAEtC,OAFJ;AAGNuC,UAAAA,IAAI,EAAEH;AAHA;AADkC,OAArB,CAAvB;AAQArC,MAAAA,WAAW,CAAC2B,QAAQ,CAACP,IAAV,CAAX;AACD,KAlBD,CAkBE,OAAOY,KAAP,EAAc,CACd;AACD;;AACDpC,IAAAA,UAAU,CAAC,KAAD,CAAV;AACD,GAvB+B,EAuB7B,CAACK,OAAD,EAAUQ,OAAO,CAAC2B,IAAlB,EAAwBzB,OAAxB,CAvB6B,CAAhC;AAyBA3C,EAAAA,SAAS,CAAC,MAAM;AACdmE,IAAAA,YAAY;AACb,GAFQ,EAEN,CAACA,YAAD,CAFM,CAAT;AAIAnE,EAAAA,SAAS,CAAC,MAAM;AACd0B,IAAAA,QAAQ,CAACN,gBAAgB,CAAC,IAAIqD,IAAJ,EAAD,CAAjB,CAAR;AACD,GAFQ,EAEN,EAFM,CAAT,CA5E+B,CA8EvB;;AAER,QAAMC,eAAe,GAAG,OAAOC,OAAP,EAAgBC,IAAhB,KAAyB;AAC/CxC,IAAAA,UAAU,CAACwC,IAAD,CAAV;AACAD,IAAAA,OAAO;AACR,GAHD;;AAKA,iBAAeE,mBAAf,CAAmCC,EAAnC,EAAuC;AACrC,mBAAeC,aAAf,GAA+B;AAC7B,UAAI;AACF,cAAM5D,GAAG,CAAC6D,MAAJ,CAAY,aAAYF,EAAG,EAA3B,CAAN;AAEAxE,QAAAA,KAAK,CAAC2E,OAAN,CAAc,0CAAd;AAEAd,QAAAA,YAAY;AACb,OAND,CAME,OAAOH,KAAP,EAAc;AACd1D,QAAAA,KAAK,CAAC0D,KAAN,CAAY,6CAAZ;AACD;AACF;;AAEDzD,IAAAA,YAAY,CAAC;AACX2E,MAAAA,QAAQ,EAAE,CACR;AAAEC,QAAAA;AAAF,OADQ,CACI;AADJ,WAGR,oBAAC,YAAD;AACE,QAAA,QAAQ,EAAEJ,aADZ;AAEE,QAAA,OAAO,EAAEI,OAFX;AAGE,QAAA,IAAI,EAAE,oBAAC,IAAD;AAAM,UAAA,IAAI,EAAC,WAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAHR;AAIE,QAAA,KAAK,EAAC,4BAJR;AAKE,QAAA,OAAO,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEALX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAJS,KAAD,CAAZ;AAaD;;AAED,WAASC,mBAAT,GAA+B;AAAA;;AAC7BlD,IAAAA,UAAU,0BAACG,UAAU,CAACgD,OAAX,CAAmBC,eAAnB,CAAmC,CAAnC,CAAD,0DAAC,sBAAuCR,EAAxC,CAAV;AACD;;AAED9E,EAAAA,SAAS,CAAC,MAAM;AACdoF,IAAAA,mBAAmB;AACpB,GAFQ,EAEN,CAACvD,WAAD,CAFM,CAAT;AAIA,SACE,0CACE;AAAK,IAAA,EAAE,EAAC,YAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,gBAAD;AACE,IAAA,WAAW,EAAEW,WAAW,CAAC+C,IAD3B;AAEE,IAAA,IAAI,EAAEpD,OAFR;AAGE,IAAA,YAAY,EAAEgC,YAHhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CAFF,EAUE,oBAAC,SAAD;AAAW,IAAA,SAAS,EAAC,cAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAG,4BAA2B1B,OAAO,CAACS,WAAY,EAAhE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAASH,WAAW,IAAIA,WAAW,CAACxB,IAApC,CADb,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAOkB,OAAO,CAAC2B,IAAR,IAAgB3B,OAAO,CAAC2B,IAAR,CAAaE,WAAb,EAAvB,CAFF,CADF,EAKE;AAAK,IAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,gBAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,oBAAC,MAAD;AACE,IAAA,IAAI,EAAC,SADP;AAEE,IAAA,QAAQ,EAAE,MAAM;AACdc,MAAAA,mBAAmB;AACpB,KAJH;AAKE,IAAA,OAAO,EAAEvD,WALX;AAME,IAAA,aAAa,EAAEA,WAAW,CAAC,CAAD,CAN5B;AAOE,IAAA,GAAG,EAAEQ,UAPP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CALF,CADF,EAoBG,CAACR,WAAW,CAAC2D,MAAb,GACC,oBAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,cAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAFF,CADF,CADD,GAQC,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAFF,EAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF,EAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAJF,EAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YALF,CADF,CADF,EAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG7D,OAAO,GACN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,KAAK,EAAC,KAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CADF,EAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CANF,EAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CAXF,EAgBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CAhBF,EAqBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CArBF,CADM,GA6BNI,QAAQ,CAAC0D,GAAT,CAAab,IAAI,IACf;AAAI,IAAA,GAAG,EAAEA,IAAI,CAACE,EAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAKF,IAAI,CAACc,UAAV,CADF,EAEG,CAACd,IAAI,CAACe,IAAN,GACC;AAAI,IAAA,OAAO,EAAC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,SAAD;AACE,IAAA,OAAO,EAAE,MACPjB,eAAe,CAAClC,WAAW,CAACoD,IAAb,EAAmBhB,IAAnB,CAFnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,UAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IALF,cADF,CADD,GAYC,0CACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGvD,WAAW,CAACuD,IAAI,CAACe,IAAN,CAAX,CAAuBE,OAAvB,CAA+B,IAA/B,EAAqC,EAArC,CADH,EAEGjB,IAAI,CAACkB,mBAAL,CAAyBC,WAAzB,EAFH,CADF,EAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAKnB,IAAI,CAACoB,eAAV,CALF,EAME;AAAI,IAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,IAAI,EAAEpB,IAAI,CAACqB,UADb;AAEE,IAAA,SAAS,EAAC,QAFZ;AAGE,IAAA,MAAM,EAAC,QAHT;AAIE,IAAA,GAAG,EAAC,qBAJN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMGrB,IAAI,CAACqB,UAAL,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,GAA3B,EANH,CADF,CANF,EAgBE;AAAI,IAAA,KAAK,EAAC,IAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,IAAI,EAAC,QADP;AAEE,IAAA,OAAO,EAAE,MAAM;AACbtB,MAAAA,mBAAmB,CAACD,IAAI,CAACE,EAAN,CAAnB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,CADF,CAhBF,CAdJ,CADF,CA9BJ,CAVF,CADF,CA5BJ,CAVF,CADF;AAuID","sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\n\r\nimport Shimmer from 'react-shimmer-effect';\r\nimport { toast } from 'react-toastify';\r\nimport { confirmAlert } from 'react-confirm-alert';\r\nimport 'react-confirm-alert/src/react-confirm-alert.css';\r\n\r\nimport { EmptyContainer, TableWrapper } from './styles';\r\n\r\nimport { useModal } from '../../hook/useModal';\r\n\r\nimport Icon from '../../components/Icons';\r\nimport Select from '../../components/Select';\r\nimport LoadLine from '../../components/LoadLine';\r\nimport Container from '../../components/Container';\r\nimport ButtonAdd from '../../components/ButtonAdd';\r\nimport ConfirmAlert from '../../components/ConfirmAlert';\r\nimport InvoiceFormModal from './components/InvoiceFormModal';\r\nimport TableDropDownCustom from '../../components/TableDropDownCustom';\r\n\r\nimport api from '../../services/api';\r\n\r\nimport { changeDateAction } from '../../store/modules/consumo/invoice/actions';\r\nimport { formatPrice } from '../../util/format';\r\n\r\nconst clocksConfigs = [\r\n  {\r\n    name: 'Gás',\r\n    value: 'GAS',\r\n  },\r\n  {\r\n    name: 'Energia',\r\n    value: 'ELECTRICITY',\r\n  },\r\n  {\r\n    name: 'Água',\r\n    value: 'WATER',\r\n  },\r\n];\r\n\r\nexport default function Contas() {\r\n  const dispatch = useDispatch();\r\n  const [loading, setLoading] = useState(false);\r\n  const [clockListId, setClockListId] = useState([]);\r\n  const [invoices, setInvoices] = useState([]);\r\n  const [clockId, setClockId] = useState();\r\n  const [payload, setPayload] = useState({});\r\n  const clockIdRef = useRef();\r\n  const { RenderModal: InvoiceModalWrapper, ...invoiceHook } = useModal();\r\n\r\n  const invoice = useSelector(state => state.invoice);\r\n  const hotelID = useSelector(state => state.user.profile.activeHotel);\r\n\r\n  const clockConfig = clocksConfigs.find(\r\n    a => a.value === invoice.consumption[0]\r\n  );\r\n\r\n  function getActiveHotelFromLocalStorage() {\r\n    const data = JSON.parse(localStorage.getItem('persist:sim'));\r\n    const user = data.user ? JSON.parse(data.user) : {};\r\n    const activeHotel = user.profile ? user.profile.activeHotel : 0;\r\n\r\n    return Number(activeHotel);\r\n  }\r\n\r\n  const loadClockID = useCallback(async () => {\r\n    try {\r\n      const response = await api.get(`/clocks`, {\r\n        params: {\r\n          hotel_id: getActiveHotelFromLocalStorage(),\r\n          clock_type: invoice.consumption[0],\r\n        },\r\n      });\r\n\r\n      setClockListId(response.data);\r\n    } catch (error) {\r\n      toast.error('Não foi possível carregar relógios.');\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [invoice, getActiveHotelFromLocalStorage()]);\r\n\r\n  useEffect(() => {\r\n    document.title = 'SIM - Consumo | Contas';\r\n\r\n    loadClockID();\r\n  }, [loadClockID]);\r\n\r\n  const loadInvoices = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      if (invoice.date === null) return;\r\n\r\n      // if (!clockId) return;\r\n\r\n      const setYear = invoice.date.getFullYear();\r\n\r\n      const response = await api.get(`/invoices`, {\r\n        params: {\r\n          hotel_id: hotelID,\r\n          clock_id: clockId,\r\n          year: setYear,\r\n        },\r\n      });\r\n\r\n      setInvoices(response.data);\r\n    } catch (error) {\r\n      // toast.error('Não foi possível carregar contas.');\r\n    }\r\n    setLoading(false);\r\n  }, [clockId, invoice.date, hotelID]);\r\n\r\n  useEffect(() => {\r\n    loadInvoices();\r\n  }, [loadInvoices]);\r\n\r\n  useEffect(() => {\r\n    dispatch(changeDateAction(new Date()));\r\n  }, []); // eslint-disable-line\r\n\r\n  const handleOpenModal = async (modalFn, item) => {\r\n    setPayload(item);\r\n    modalFn();\r\n  };\r\n\r\n  async function handleInvoiceDelete(id) {\r\n    async function deleteInvoice() {\r\n      try {\r\n        await api.delete(`/invoices/${id}`);\r\n\r\n        toast.success('Leitura de consumo excluída com sucesso.');\r\n\r\n        loadInvoices();\r\n      } catch (error) {\r\n        toast.error('Não foi possível remover conta selecionada.');\r\n      }\r\n    }\r\n\r\n    confirmAlert({\r\n      customUI: (\r\n        { onClose } // eslint-disable-line\r\n      ) => (\r\n        <ConfirmAlert\r\n          callback={deleteInvoice}\r\n          onClose={onClose}\r\n          icon={<Icon name=\"iconTrash\" />}\r\n          title=\"Deletar leitura de consumo\"\r\n          message={<p>Tem certeza que deseja deletar leitura de consumo?</p>}\r\n        />\r\n      ),\r\n    });\r\n  }\r\n\r\n  function handleClockOnChange() {\r\n    setClockId(clockIdRef.current.selectedOptions[0]?.id);\r\n  }\r\n\r\n  useEffect(() => {\r\n    handleClockOnChange();\r\n  }, [clockListId]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"modal-root\" />\r\n      <InvoiceModalWrapper>\r\n        <InvoiceFormModal\r\n          handleClose={invoiceHook.hide}\r\n          item={payload}\r\n          loadInvoices={loadInvoices}\r\n        />\r\n      </InvoiceModalWrapper>\r\n\r\n      <Container className=\"content full\">\r\n        <div className={`title title--dropdown dd-${invoice.consumption}`}>\r\n          <div className=\"dd-title\">\r\n            Consumo de <strong>{clockConfig && clockConfig.name}</strong>\r\n            <span>{invoice.date && invoice.date.getFullYear()}</span>\r\n          </div>\r\n          <div className=\"dd-select\">\r\n            <Icon name=\"iconClockSmall\" />\r\n            <Select\r\n              name=\"clockid\"\r\n              onChange={() => {\r\n                handleClockOnChange();\r\n              }}\r\n              options={clockListId}\r\n              defaultOption={clockListId[0]}\r\n              ref={clockIdRef}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {!clockListId.length ? (\r\n          <EmptyContainer>\r\n            <div className=\"inner\">\r\n              <Icon name=\"iconClockBig\" />\r\n              <p>Nenhum relógio foi selecionado.</p>\r\n            </div>\r\n          </EmptyContainer>\r\n        ) : (\r\n          <TableWrapper>\r\n            <table>\r\n              <thead>\r\n                <tr>\r\n                  <th>Mês</th>\r\n                  <th>Consumo</th>\r\n                  <th>Valor (R$)</th>\r\n                  <th>Anexo</th>\r\n                  <th>&nbsp;</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {loading ? (\r\n                  <tr>\r\n                    <td width=\"15%\">\r\n                      <Shimmer>\r\n                        <LoadLine />\r\n                      </Shimmer>\r\n                    </td>\r\n                    <td>\r\n                      <Shimmer>\r\n                        <LoadLine />\r\n                      </Shimmer>\r\n                    </td>\r\n                    <td>\r\n                      <Shimmer>\r\n                        <LoadLine />\r\n                      </Shimmer>\r\n                    </td>\r\n                    <td>\r\n                      <Shimmer>\r\n                        <LoadLine />\r\n                      </Shimmer>\r\n                    </td>\r\n                    <td>\r\n                      <Shimmer>\r\n                        <LoadLine />\r\n                      </Shimmer>\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  invoices.map(item => (\r\n                    <tr key={item.id}>\r\n                      <td>{item.month_name}</td>\r\n                      {!item.read ? (\r\n                        <td colSpan=\"4\">\r\n                          <ButtonAdd\r\n                            onClick={() =>\r\n                              handleOpenModal(invoiceHook.show, item)\r\n                            }\r\n                          >\r\n                            <Icon name=\"iconPlus\" />\r\n                            Adicionar\r\n                          </ButtonAdd>\r\n                        </td>\r\n                      ) : (\r\n                        <>\r\n                          <td>\r\n                            {formatPrice(item.read).replace('R$', '')}\r\n                            {item.unit_of_measurement.toLowerCase()}\r\n                          </td>\r\n                          <td>{item.value_formatted}</td>\r\n                          <td className=\"attachment\">\r\n                            <a\r\n                              href={item.attachment}\r\n                              className=\"attach\"\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                            >\r\n                              {item.attachment.split('/').pop()}\r\n                            </a>\r\n                          </td>\r\n                          <td width=\"75\">\r\n                            <TableDropDownCustom>\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => {\r\n                                  handleInvoiceDelete(item.id);\r\n                                }}\r\n                              >\r\n                                Excluir\r\n                              </button>\r\n                            </TableDropDownCustom>\r\n                          </td>\r\n                        </>\r\n                      )}\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </TableWrapper>\r\n        )}\r\n      </Container>\r\n    </>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}